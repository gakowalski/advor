To build AdvOR.dll install masm32 from http://www.masm32.com then execute DLL\a.bat


## Instructions for building AdvOR with MinGW (http://www.mingw.org/)
##

Stage One:  Download and Install MinGW.
---------------------------------------

Download mingw:
http://prdownloads.sf.net/mingw/MinGW-5.1.4.exe?download

Download msys:
http://prdownloads.sf.net/mingw/MSYS-1.0.10.exe?download

Download the mingw developer tool kit:
http://prdownloads.sf.net/mingw/msysDTK-1.0.1.exe?download

Download the mingw autoconf-2.61 update:
https://sourceforge.net/projects/mingw/files/OldFiles/msys-autoconf/autoconf-2.61-MSYS-1.0.11-1.tar.bz2/download

Install mingw, msys and mingw-dtk.  Extract autoconf-2.61-MSYS-1.0.11-1.tar.bz2 into
your mingw install location.  For example, if you installed mingw into
/c/mingw/1.0/ you want to extract msys-autoconf-2.61 into this
directory.

Create a directory called "AdvOR".

Download masm32 from http://masm32.com/masmdl.htm

Install masm32.




Stage Two:  Download, extract, compile zlib
---------------------------------------------

Download zlib source:
http://zlib.net/zlib-1.2.11.tar.gz

Extract zlib:
Copy the zlib tarball into the "AdvOR" directory
Type "cd AdvOR/"
Type "tar zxf zlib-1.2.11.tar.gz"

CHOICE:

Make zlib.a:
Type "cd zlib-1.2.11/"
Type "./configure"
Type "make -f win32/Makefile.gcc"
Assuming you have MingGW installed in c:/ :
Type cp -iv zlib1.dll c:/mingw/bin
Type cp -iv zconf.h zlib.h c:/mingw/include
Type cp -iv libz.a c:/mingw/lib/libzlib.a

Done.



Stage Three:  Download, extract, compile openssl
----------------------------------------------

Download openssl:
https://www.openssl.org/source/openssl-1.1.0e.tar.gz

Extract openssl:
Copy the openssl tarball into the "AdvOR" directory.
Type "cd AdvOR/"
Type "tar zxf openssl-1.1.0e.tar.gz"

Edit MinGW/include/wincrypt.h and add the following lines:
	typedef struct _PUBKEY {
	DWORD magic ;
	DWORD bitlen ;
	} DSSPUBKEY ;

	#define CERT_STORE_PROV_SYSTEM_A ((LPCSTR) 9)
	#define CERT_STORE_READONLY_FLAG 0x00008000
	// BOOL WINAPI CryptEnumProvidersA( DWORD, DWORD *, DWORD, DWORD *, LPSTR, DWORD *) ;

If you're using an older version of Perl for MinGW:
  Download Perl-MinGW from https://sourceforge.net/projects/perl-mingw/
  Extract bin, lib and share from perl-5.24.0-mingw32.zip/perl-5.24.0/ to the msys/1.0/ directory

Make openssl libraries:
Type "cd openssl-1.1.0e/"
Type "./Configure no-shared no-afalgeng no-autoalginit no-stdio no-capieng -no-idea -no-rc5 -no-mdc2 mingw"
Edit Makefile and replace "\" with "/" in the line containing "PERL="
Edit crypto/init.c and replace
	"ret = GetModuleHandleEx(GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS | GET_MODULE_HANDLE_EX_FLAG_PIN,(void *)&base_inited, &handle);"
	with:
	"handle = GetModuleHandle((void *)&base_inited);ret = 1;"
	and
	"ret = GetModuleHandleEx(GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS | GET_MODULE_HANDLE_EX_FLAG_PIN,handlersym.sym, &handle);
	with:
	"handle = GetModuleHandle(handlersym.sym);ret = 1;"
Type "make depend"
# The next steps can take up to 30 minutes to complete.
Type "make"
Type "make install"


Stage Four: Download, extract, and compile libevent-2.1.8
------------------------------------------------------

Download the libevent 2.1.8 release:
https://github.com/libevent/libevent/releases/download/release-2.1.8-stable/libevent-2.1.8-stable.tar.gz

Copy the libevent tarball into the "AdvOR" directory.

Extract libevent.
Copy the libevent tarball into the "AdvOR" directory.
Type "cd AdvOR/"
Type "tar zxf libevent-2.1.8-stable.tar.gz"

Type "cd libevent-2.1.8-stable/"
Type "./configure --enable-static --disable-shared"
Edit Makefile and replace "am__EXEEXT_2 = sample/le-proxy$(EXEEXT) \ sample/https-client$(EXEEXT)" with "am__EXEEXT_2 = "
Edit Makefile and replace "test/test-weof$(EXEEXT) test/regress$(EXEEXT)" with "test/test-weof$(EXEEXT)"
Type "make"
Type "make install"


Stage Five: Download, extract, and compile libntlm-1.4
------------------------------------------------------

Download the libntlm 1.4 release:
http://www.nongnu.org/libntlm/releases/

Copy the libevent tarball into the "AdvOR" directory.
Type "cd AdvOR"

Extract libntlm.

Type "./configure --enable-static --disable-shared"
Type "make"
Type "make install"


Stage Six:  Build AdvOR
----------------------

Download the current AdvOR release from https://sourceforge.net/projects/AdvTor/ .
Extract AdvOR-src.zip into the "AdvOR" directory.

cd AdvOR
Type "./configure --disable-dependency-tracking"
Type "make"

You now have a AdvOR.exe in src/or/.

